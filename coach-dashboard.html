<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach-Dashboard - Triadisches KI-Coaching</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .main-container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .session-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .session-info h1 { color: #4a5568; font-size: 24px; }
        .session-details { background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .session-id { font-family: monospace; background: #e2e8f0; padding: 5px 10px; border-radius: 4px; font-size: 14px; }
        .coachee-link { background: #48bb78; color: white; padding: 8px 15px; border-radius: 6px; text-decoration: none; font-size: 14px; margin-left: 10px; }
        .header-buttons { display: flex; gap: 10px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a6fd8; transform: translateY(-2px); }
        .btn-secondary { background: #e2e8f0; color: #4a5568; }
        .progress-container { background: #f7fafc; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .progress-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: relative; }
        .progress-bar::before { content: ''; position: absolute; top: 20px; left: 0; right: 0; height: 2px; background: #e2e8f0; z-index: 1; }
        .step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 2; cursor: pointer; transition: all 0.3s; }
        .step-circle { width: 40px; height: 40px; border-radius: 50%; background: #e2e8f0; color: #a0aec0; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-bottom: 8px; transition: all 0.3s; }
        .step.active .step-circle { background: #667eea; color: white; }
        .step.completed .step-circle { background: #48bb78; color: white; }
        .step-label { font-size: 11px; text-align: center; color: #4a5568; max-width: 80px; }
        .step-details { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .step-title { color: #2d3748; font-size: 18px; margin-bottom: 15px; font-weight: 600; }
        .task-list { list-style: none; margin-bottom: 15px; }
        .task-item { display: flex; align-items: flex-start; padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .task-item:last-child { border-bottom: none; }
        .task-checkbox { margin-right: 10px; margin-top: 2px; }
        .task-text { flex: 1; line-height: 1.4; font-size: 14px; }
        .task-item.completed .task-text { text-decoration: line-through; color: #a0aec0; }
        .chat-container { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 20px; margin-bottom: 20px; height: 600px; }
        .coachee-dialog { grid-column: 1; grid-row: 1 / 3; }
        .ki-assistant { grid-column: 2; grid-row: 1; }
        .coach-notes { grid-column: 2; grid-row: 2; }
        .chat-panel { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .chat-header { padding: 15px 20px; border-bottom: 1px solid #e2e8f0; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .coachee-header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .ki-header { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
        .notes-header { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; }
        .connection-status { font-size: 12px; padding: 4px 8px; border-radius: 4px; }
        .connected { background: rgba(72, 187, 120, 0.2); color: #22543d; }
        .disconnected { background: rgba(245, 101, 101, 0.2); color: #742a2a; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; background: #f7fafc; }
        .message { margin-bottom: 12px; padding: 10px 14px; border-radius: 10px; max-width: 85%; }
        .message.coach { background: #667eea; color: white; margin-left: auto; }
        .message.coachee { background: white; color: #2d3748; border: 1px solid #e2e8f0; }
        .message.ki { background: #e6fffa; color: #234e52; border: 1px solid #81e6d9; position: relative; }
        .forward-btn { position: absolute; top: 8px; right: 8px; background: #667eea; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; opacity: 0.8; transition: all 0.2s; }
        .forward-btn:hover { opacity: 1; background: #5a6fd8; }
        .forward-modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .forward-modal-content { background: white; margin: 10% auto; padding: 20px; border-radius: 12px; width: 90%; max-width: 600px; }
        .forward-modal h3 { margin-bottom: 15px; color: #2d3748; }
        .forward-text { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 6px; min-height: 100px; font-family: inherit; font-size: 14px; }
        .forward-buttons { margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end; }
        .forward-buttons button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .btn-send-to-coachee { background: #48bb78; color: white; }
        .btn-cancel { background: #e2e8f0; color: #4a5568; }
        .message.note { background: #fed7d7; color: #822727; border: 1px solid #feb2b2; }
        .message-sender { font-size: 11px; font-weight: 600; margin-bottom: 4px; opacity: 0.8; }
        .message-time { font-size: 10px; opacity: 0.6; float: right; }
        .chat-input-container { padding: 15px; border-top: 1px solid #e2e8f0; }
        .chat-input { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; resize: vertical; min-height: 35px; }
        .chat-input:focus { outline: none; border-color: #667eea; }
        .send-btn { margin-top: 8px; background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px; }
        .send-btn:hover { background: #5a6fd8; }
        .send-btn.ki { background: #48bb78; }
        .send-btn.ki:hover { background: #38a169; }
        .send-btn.notes { background: #ed8936; }
        .send-btn.notes:hover { background: #dd6b20; }
        .navigation { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: white; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .suggestions { background: #f0f4f8; border-radius: 6px; padding: 12px; margin-top: 10px; }
        .suggestions h4 { color: #2d3748; margin-bottom: 8px; font-size: 13px; }
        .suggestion-item { background: white; padding: 8px; margin: 4px 0; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s; }
        .suggestion-item:hover { background: #e2e8f0; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 2% auto; padding: 0; border-radius: 15px; width: 95%; max-width: 1200px; height: 90vh; display: flex; flex-direction: column; }
        .modal-header { padding: 20px 25px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px 15px 0 0; }
        .modal-body { flex: 1; padding: 25px; overflow-y: auto; }
        .close { color: white; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { opacity: 0.7; }
        .search-container { margin-bottom: 20px; }
        .search-input { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; }
        .search-input:focus { outline: none; border-color: #667eea; }
        .category { margin-bottom: 25px; border: 1px solid #e2e8f0; border-radius: 10px; overflow: hidden; }
        .category-header { background: linear-gradient(135deg, #f7fafc, #edf2f7); padding: 12px 15px; font-weight: 600; color: #2d3748; border-bottom: 1px solid #e2e8f0; font-size: 14px; }
        .category-description { font-size: 12px; color: #4a5568; margin-top: 4px; }
        .prompts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; padding: 15px; }
        .prompt-card { background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 12px; cursor: pointer; transition: all 0.3s; }
        .prompt-card:hover { border-color: #667eea; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.1); transform: translateY(-1px); }
        .prompt-code { font-weight: bold; color: #667eea; margin-bottom: 6px; font-size: 13px; }
        .prompt-text { color: #4a5568; font-size: 12px; line-height: 1.3; max-height: 80px; overflow: hidden; }
        .copy-feedback { position: fixed; top: 20px; right: 20px; background: #48bb78; color: white; padding: 10px 16px; border-radius: 6px; font-weight: 500; z-index: 1001; transform: translateX(100%); transition: transform 0.3s; font-size: 14px; }
        .copy-feedback.show { transform: translateX(0); }
        .phase-badge { display: inline-block; background: #e2e8f0; color: #4a5568; padding: 3px 6px; border-radius: 3px; font-size: 10px; font-weight: 500; margin-bottom: 8px; }
        .phase-a { background: #fef5e7; color: #744210; }
        .phase-b { background: #e6fffa; color: #234e52; }
        .phase-c { background: #f0fff4; color: #22543d; }
        @media (max-width: 1200px) { .chat-container { grid-template-columns: 1fr; grid-template-rows: auto; height: auto; } .coachee-dialog { grid-column: 1; grid-row: 1; } .ki-assistant { grid-column: 1; grid-row: 2; } .coach-notes { grid-column: 1; grid-row: 3; } .chat-panel { height: 400px; } }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div class="session-info">
                <div>
                    <h1>🎯 Coach-Dashboard - Triadisches KI-Coaching</h1>
                    <div class="session-details">
                        <strong>Session:</strong> <span class="session-id" id="sessionId">COACH-2025-001</span>
                        <a href="#" class="coachee-link" onclick="copyCoacheeLink()">📋 Coachee-Link kopieren</a>
                        <div style="margin-top: 5px; font-size: 14px; color: #4a5568;">
                            <strong>Coachee-Status:</strong> <span class="connection-status disconnected" id="coacheeStatus">Nicht verbunden</span>
                        </div>
                    </div>
                </div>
                <div class="header-buttons">
                    <button class="btn btn-primary" onclick="openRepository()">📚 Repository</button>
                    <button class="btn btn-secondary" onclick="startNewSession()">🔄 Neue Session</button>
                </div>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="step-details" id="stepDetails"></div>

        <div class="chat-container">
            <!-- Coachee Dialog - Was der Coachee sieht -->
            <div class="chat-panel coachee-dialog">
                <div class="chat-header coachee-header">
                    💬 Dialog mit Coachee
                    <span class="connection-status disconnected" id="coacheeConnectionStatus">Offline</span>
                </div>
                <div class="chat-messages" id="coacheeMessages">
                    <div class="message coachee">
                        <div class="message-sender">System</div>
                        Warten auf Coachee-Verbindung... Teilen Sie den Coachee-Link für den Start der Session.
                        <div class="message-time">16:22</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <textarea class="chat-input" id="coacheeInput" placeholder="Nachricht an Coachee..." rows="2"></textarea>
                    <button class="send-btn" onclick="sendMessage('coachee')">An Coachee senden</button>
                </div>
                <div class="suggestions" id="coacheeSuggestions">
                    <h4>💡 Empfohlene Fragen für diesen Schritt:</h4>
                </div>
            </div>

            <!-- KI Assistant - Private Coach ↔ KI Kommunikation -->
            <div class="chat-panel ki-assistant">
                <div class="chat-header ki-header">
                    🤖 KI-Assistent (privat)
                </div>
                <div class="chat-messages" id="kiMessages">
                    <div class="message ki">
                        <div class="message-sender">KI-Assistent</div>
                        Bereit für Coaching-Unterstützung. Nutzen Sie das Repository für strukturierte Prompts oder fragen Sie mich direkt.
                        <div class="message-time">16:22</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <textarea class="chat-input" id="kiInput" placeholder="Frage an KI-Assistenten..." rows="2"></textarea>
                    <button class="send-btn ki" onclick="sendMessage('ki')">KI fragen</button>
                </div>
                <div class="suggestions" id="kiSuggestions">
                    <h4>🔧 KI-Unterstützung für diesen Schritt:</h4>
                </div>
            </div>

            <!-- Coach Notes - Private Notizen -->
            <div class="chat-panel coach-notes">
                <div class="chat-header notes-header">
                    📋 Coach-Notizen (privat)
                </div>
                <div class="chat-messages" id="notesMessages">
                    <div class="message note">
                        <div class="message-sender">Notiz</div>
                        Session gestartet - warte auf Coachee. Ziel: Strukturierter 12-Schritte Prozess.
                        <div class="message-time">16:22</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <textarea class="chat-input" id="notesInput" placeholder="Private Notizen..." rows="2"></textarea>
                    <button class="send-btn notes" onclick="sendMessage('notes')">Notiz hinzufügen</button>
                </div>
            </div>
        </div>

        <div class="navigation">
            <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn">← Vorheriger</button>
            <span id="stepCounter">Schritt 1 von 12</span>
            <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">Nächster →</button>
        </div>
    </div>

    <!-- Repository Modal -->
    <div id="repositoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📚 Triadisches Repository</h2>
                <span class="close" onclick="closeRepository()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Suchen nach Codes oder Stichwörtern..." oninput="searchPrompts()">
                </div>
                <div id="repositoryContent"></div>
            </div>
        </div>
    </div>

    <!-- Forward to Coachee Modal -->
    <div id="forwardModal" class="forward-modal">
        <div class="forward-modal-content">
            <h3>📤 An Coachee weiterleiten</h3>
            <p style="margin-bottom: 15px; color: #4a5568; font-size: 14px;">
                Bearbeiten Sie die Nachricht bevor Sie sie an den Coachee senden:
            </p>
            <textarea id="forwardText" class="forward-text" placeholder="Nachricht bearbeiten..."></textarea>
            <div class="forward-buttons">
                <button class="btn-cancel" onclick="closeForwardModal()">Abbrechen</button>
                <button class="btn-send-to-coachee" onclick="sendToCoachee()">An Coachee senden</button>
            </div>
        </div>
    </div>

    <div id="copyFeedback" class="copy-feedback">Kopiert! ✓</div>

    <script>
        const steps = [
            {id: 1, title: "Problem- und Zielbeschreibung", phase: "A", tasks: ["Problem beschreiben", "Ziele definieren", "Wichtigkeit bewerten", "Ressourcen identifizieren"], coachingSuggestions: ["Was möchten Sie erreichen?", "Wie wichtig ist dieses Ziel?", "Was hindert Sie?"], assistantSuggestions: ["Analysiere Ausbalancierungsprobleme", "Identifiziere Ressourcen", "Prüfe Zielformulierung"]},
            {id: 2, title: "Systemische Einordnung", phase: "A", tasks: ["Kontext erfassen", "Beteiligte identifizieren", "Wechselwirkungen analysieren", "Systemressourcen erkunden"], coachingSuggestions: ["Wer ist betroffen?", "Welche Rollen spielen andere?", "Wie sehen andere die Situation?"], assistantSuggestions: ["Erstelle systemische Karte", "Analysiere Abhängigkeiten", "Identifiziere Allianzen"]},
            {id: 3, title: "Bildmetapher entwickeln", phase: "A", tasks: ["Inneres Bild finden", "Metapher beschreiben", "Emotionale Resonanz", "Veränderungspotential"], coachingSuggestions: ["Wie sähe Ihre Situation als Bild aus?", "Welche Farben sehen Sie?", "Was fühlen Sie dabei?"], assistantSuggestions: ["Unterstütze Bildentwicklung", "Erkunde Symbolik", "Finde Veränderungsmöglichkeiten"]},
            {id: 4, title: "Ausbalancierungsprobleme", phase: "A", tasks: ["Spannungsfelder identifizieren", "Polaritäten analysieren", "Ungleichgewichte erkennen", "Komplementäre Kräfte"], coachingSuggestions: ["Zwischen welchen Polen bewegen Sie sich?", "Wo spüren Sie Ungleichgewicht?", "Was wäre das Gegenteil?"], assistantSuggestions: ["Analysiere 18 Dimensionen", "Identifiziere Spannungsfelder", "Bestimme Balance-Kräfte"]},
            {id: 5, title: "Schlüsselaffekt benennen", phase: "B", tasks: ["Emotionen identifizieren", "Körperempfindungen", "Auslöser erkunden", "Zusammenhänge herstellen"], coachingSuggestions: ["Welches Gefühl ist am stärksten?", "Wo spüren Sie es im Körper?", "Wann taucht es auf?"], assistantSuggestions: ["Identifiziere Schlüsselaffekt", "Verbinde mit Spannungsfeldern", "Analysiere Muster"]},
            {id: 6, title: "Inneres Team aufstellen", phase: "B", tasks: ["Anteile identifizieren", "Namen und Charakteristika", "Positive Absichten", "Teamchef bestimmen"], coachingSuggestions: ["Welche Stimmen hören Sie?", "Geben Sie jedem einen Namen", "Was will jeder Anteil?"], assistantSuggestions: ["Identifiziere Anteile", "Beschreibe Absichten", "Bestimme Teamchef"]},
            {id: 7, title: "Dialog zwischen Anteilen", phase: "B", tasks: ["Konflikte moderieren", "Perspektiven verstehen", "Gemeinsame Werte", "Kooperationen entwickeln"], coachingSuggestions: ["Was würde der eine dem anderen sagen?", "Wo haben beide recht?", "Wie könnten sie kooperieren?"], assistantSuggestions: ["Moderiere Dialog", "Finde gemeinsame Werte", "Entwickle Kooperationen"]},
            {id: 8, title: "Lösungsstrategie entwickeln", phase: "C", tasks: ["Handlungsoptionen erarbeiten", "Strategien entwickeln", "Ressourcen aktivieren", "Schritte planen"], coachingSuggestions: ["Welche Möglichkeiten sehen Sie?", "Was würde helfen?", "Welche Unterstützung brauchen Sie?"], assistantSuggestions: ["Entwickle Strategien", "Integriere Erkenntnisse", "Plane Umsetzung"]},
            {id: 9, title: "Anteile transformieren", phase: "C", tasks: ["Neue Rollen definieren", "Transformation einleiten", "Hilfreiche Anteile stärken", "Teamdynamik etablieren"], coachingSuggestions: ["Wie könnte sich der Anteil verhalten?", "Welche neue Rolle passt?", "Wie führt der Teamchef?"], assistantSuggestions: ["Unterstütze Transformation", "Entwickle neue Rollen", "Stärke Teamchef"]},
            {id: 10, title: "Glaubenssätze transformieren", phase: "C", tasks: ["Limiting beliefs identifizieren", "Neue Glaubenssätze", "Verankerung", "Integration"], coachingSuggestions: ["Welche Überzeugungen hindern?", "Was möchten Sie glauben?", "Wie stärken Sie das?"], assistantSuggestions: ["Identifiziere Glaubenssätze", "Entwickle Alternativen", "Plane Verankerung"]},
            {id: 11, title: "Erfolgsimagination kreieren", phase: "C", tasks: ["Zukunftsvision entwickeln", "Emotionale Verankerung", "Anteile integrieren", "Motivation aktivieren"], coachingSuggestions: ["Was sehen, hören, fühlen Sie?", "Wie verhalten sich die Anteile?", "Was ist das Beste?"], assistantSuggestions: ["Kreiere Imagination", "Integriere Anteile", "Nutze Bildmetapher"]},
            {id: 12, title: "Integration und Handlungsplan", phase: "C", tasks: ["Erkenntnisse zusammenfassen", "Handlungsplan erstellen", "Erfolgskontrollen", "Transfer sicherstellen"], coachingSuggestions: ["Was ist die wichtigste Erkenntnis?", "Welche Schritte gehen Sie?", "Wie bleiben Sie dran?"], assistantSuggestions: ["Erstelle Zusammenfassung", "Entwickle Plan", "Plane Follow-up"]}
        ];

        const promptDatabase = {
            'ki_prompts': {title: '🤖 KI-Prompts', description: 'Anweisungen AN die KI', prompts: {
                'T1': 'Ich habe folgendes Problem und möchte es mit Ihnen bearbeiten: [PROBLEM BESCHREIBUNG]. Können Sie mir dabei helfen, eine strukturierte Herangehensweise zu entwickeln?',
                'T2': 'Erstelle einen in Ich-Form geschriebenen Bericht, in dem alle bisher vorliegenden Informationen der Problem- und Zielbeschreibung zusammengefasst sind. Gliedere diesen Bericht in zwei Teile: 1) Problembeschreibung - was belastet mich und hindert mich daran, mein Ziel zu erreichen, und 2) Zielbeschreibung - was möchte ich erreichen und wie würde ich merken, dass ich mein Ziel erreicht habe.',
                'T3': 'Analysiere die vorliegenden Informationen und identifiziere die Kernproblematik. Welche Muster und Zusammenhänge sind erkennbar? Welche tieferliegenden Themen könnten eine Rolle spielen?',
                'T4': 'Identifiziere aus dem Textbaustein Ausbalancierungsprobleme die relevanten Spannungsfelder für diese Problematik. Welche der 18 Dimensionen sind hier besonders aktiv?',
                'T7A': 'Versetze dich bitte in die Bremse - den inneren Anteil, der vor Veränderung warnt. Was würde dieser Anteil sagen? Welche Bedenken und Ängste hat er? Was will er schützen?',
                'T7B': 'Analysiere das obige Transkript sowie alle momentan vorliegenden Informationen zu meiner Coachingproblematik mit Hilfe des Textbausteins Ausbalancierungsprobleme und erstelle mit Blick auf die 18 Ausbalancierungsdimensionen eine detaillierte Diagnose.',
                'T11': 'Orientiere dich bei dieser Aufgabe an dem Textbaustein Ausbalancierungsprobleme, da ist Coaching-diagnostisches Wissen hinterlegt. Gehe dabei im Einzelnen folgendermaßen vor: Beziehe dich auf die Komplementärkräfte und entwickle eine Erfolgsimagination.'
            }},
            'coach_instructions': {title: '👨‍💼 Coach-Anweisungen', description: 'WIE der Coach vorgeht', prompts: {
                'C1': 'Stellen Sie sich vor, da ist ein Teamchef in Ihnen - das ist der Teil, der dieses Ziel erreichen will. Wählen Sie eine Figur für diesen Teamchef und beschreiben Sie ihn. Wie sieht er aus? Wie verhält er sich? Was ist seine Art zu sprechen?',
                'C2': 'Führen Sie den Klienten durch eine systematische Exploration der verschiedenen inneren Anteile. Identifizieren Sie mindestens 3-4 verschiedene Stimmen und geben Sie jeder einen Namen.',
                'C3': 'Ich möchte gerne mit der Bremse sprechen - dem Anteil, der Sie vor Veränderung schützen will. Was würde dieser Anteil Ihnen sagen? Welche Bedenken hat er?',
                'C4': 'Leiten Sie eine Ressourcen-Aktivierung ein und identifizieren Sie vorhandene Stärken. Welche Erfolge haben Sie in ähnlichen Situationen bereits erlebt?'
            }},
            'client_questions': {title: '❓ Klienten-Fragen', description: 'Fragen AN den Klienten', prompts: {
                'F1': 'Beschreiben Sie mir bitte in 1-2 Sätzen, was Sie heute in unserem Coaching erreichen möchten.',
                'F2': 'Auf einer Skala von 0 bis 10: Wie wichtig ist Ihnen dieses Ziel? Und wie zuversichtlich sind Sie, dass Sie es erreichen können?',
                'F3': 'Was hindert Sie hauptsächlich daran, dieses Ziel zu erreichen? Was steht Ihnen im Weg?',
                'F4': 'Welche Ressourcen und Stärken haben Sie bereits zur Verfügung? Was hat Ihnen in der Vergangenheit geholfen?',
                'F5': 'Wie würden Sie konkret merken, dass Sie Ihr Ziel erreicht haben? Was wäre dann anders in Ihrem Leben?'
            }},
            'diagnostik': {title: '🧠 Diagnostik', description: 'Spannungsfelder erfassen', prompts: {
                'D1': 'Analysiere die folgende Aussage mit Blick auf mögliche Ausbalancierungsprobleme: ‹Ich kann einfach nicht loslassen – ich muss alles selbst im Griff haben.› – Welche Spannungsdimensionen sind hier aktiv? – Welche komplementäre Kraft könnte hilfreich sein? – Was wäre ein ressourcenfokussierter Coachingansatz?',
                'D2': 'Lies folgende Klient:innenaussage: ‹Ich weiss, ich sollte etwas tun, aber innerlich bin ich wie gelähmt.› – Welcher Schlüsselaffekt zeigt sich hier? – Was könnte die innere Dynamik dahinter sein? – Welche erste kleine Intervention wäre denkbar?',
                'D3': 'Eine Klientin sagt: ‹Ein Teil von mir will einfach Ruhe, aber der andere macht mir Druck, weiterzumachen.› – Welche zwei inneren Anteile könnten hier aktiv sein? – Was wollen sie jeweils schützen oder erreichen? – Wie könnte der Coach innere Verständigung anregen?',
                'D4': 'Ein Coachee sagt: ‹Ich muss immer stark sein – Schwäche zeigen geht nicht.› – Welcher dysfunktionale Glaubenssatz ist hier aktiv? – Welcher positive Wert steckt vielleicht dahinter? – Wie könnte man diesen Satz achtsam in Frage stellen?'
            }},
            'intervention': {title: '🛠️ Intervention', description: 'Lösungsorientierte Tools', prompts: {
                'I1': 'Ein Coachee sagt: ‹Ich weiss nicht, wie ich anfangen soll – es ist alles zu viel.› – Welche kleine lösungsfokussierte Frage könnte den nächsten Schritt erleichtern? – Welche vorhandene Ressource kann aktiviert werden? – Was wäre eine hilfreiche Skalierungsfrage dazu?',
                'I2': 'Bitte formuliere eine motivierende Erfolgsimagination in Ich-Form für folgende Zielrichtung: ‹Ich möchte in meinem Ruhestand klarer spüren, was mir gut tut – und mutiger danach handeln.› – Baue sinnliche Eindrücke ein (sehen, hören, fühlen) – Zeige den Unterschied zur Ausgangssituation – Integriere den inneren Dialog der Veränderung',
                'I3': 'Stelle einem Coachee mit aktuellem Mutverlust folgende Frage: ‹Wann in deinem Leben hast du schon einmal eine ähnliche Situation bewältigt – und wie hast du das damals geschafft?› – Welche Elemente aus der damaligen Lösung lassen sich heute nutzen? – Was hat dich damals gestützt?',
                'I4': 'Ein Coachee sagt: ‹Ich werde im Ruhestand ganz sicher überflüssig sein.› – Formuliere eine Frage, die den gegenteiligen Gedanken prüft, z. B.: ‹Was wäre, wenn du gerade dann besonders gebraucht wirst – vielleicht anders als bisher?› – Welche neue Perspektive könnte daraus entstehen?',
                'I5': 'Stelle dir vor, du begegnest deinem 10 Jahre älteren Ich – es wirkt ruhig, klar und zugewandt. – Was würde es dir raten für deine aktuelle Situation? – Welche Werte oder Haltungen strahlt es aus? – Was sagt es dir über den Weg, den du gehen willst?'
            }},
            'textbausteine': {title: '🧠 KI-Textbausteine', description: 'Coaching-DNA', prompts: {
                'TB1': 'COACHING SOLUTION FINDER: Du bist ein erfahrener, empathischer Coach. Deine Aufgabe ist es, ressourcenorientiert und wertschätzend zu antworten. Beginne immer mit einer dankenden Begrüßung für das Vertrauen. Paraphrasiere das Problem in eigenen Worten, normalisiere es ("Das ist nicht ungewöhnlich...") und hebe bereits erkennbare Stärken, Ressourcen oder positive Ansätze hervor. Dein Ton ist warmherzig, ermutigend und professionell. Fokussiere auf Potenziale statt Defizite.',
                'TB2': 'AUSBALANCIERUNGSPROBLEME (18 Dimensionen): 1. Minderwertigkeit vs. Großartigkeit, 2. Anerkennungsstreben vs. Egozentrik, 3. Selbstinszenierung vs. Zurückhaltung, 4. Kontrolle vs. Vertrauen, 5. Nähe vs. Distanz, 6. Rationalität vs. Intuition, 7. Perfektion vs. Spontaneität, 8. Sicherheit vs. Risiko, 9. Autonomie vs. Zugehörigkeit, 10. Struktur vs. Flexibilität, 11. Leistung vs. Entspannung, 12. Selbstfürsorge vs. Aufopferung, 13. Offenheit vs. Bewahrung, 14. Durchsetzung vs. Harmonie, 15. Individualität vs. Anpassung, 16. Aktivität vs. Passivität, 17. Optimismus vs. Realismus, 18. Bindung vs. Freiheit. Jede Dimension beschreibt ein mögliches inneres Spannungsfeld.',
                'TB3': 'SCHLÜSSELAFFEKTE: "Ich fühle mich wie gelähmt und meine Gedanken kreisen..." / "Ich bin wie blockiert und alles andere erscheint plötzlich wichtiger..." / "Ich spüre Enttäuschung/Überforderung und kann keinen klaren Gedanken fassen..." / "Ich fühle mich innerlich unruhig und getrieben..." / "Es steigt Panik in mir auf und ich will nur noch weg..." / "Ich spüre eine bleierne Schwere und Mutlosigkeit..."',
                'TB4': 'ERFOLGSIMAGINATION: Erstelle eine lebhafte, sinnliche Erzählung in Ich-Form mit folgenden Elementen: – Beginne mit der ursprünglichen Schlüsselsituation – Beschreibe die neue, positive Reaktion detailliert – Integriere die komplementären Kräfte der Ausbalancierungsprobleme – Verwende die Bildmetapher aus Schritt 3 – Mache es filmisch erlebbar (was sehe, höre, fühle ich?) – Beschreibe innere Dialoge und neue Gedankenmuster – Zeige konkrete Handlungen und deren positive Konsequenzen',
                'TB5': 'INNERE ANTEILE: Teamchefin/Zielerreicher (rational, zielorientiert, plant), Unterstützerin/Mutmacher (optimistisch, ermutigend, sieht Chancen), Bremse/Beschützer (vorsichtig, sicherheitsorientiert, warnt), Kritiker/Perfektionist (hohe Standards, fehlerfinderisch), Anerkennungssucher (braucht Bestätigung, möchte gemocht werden), Rebell/Innovator (hinterfragt Regeln, will Neues), Harmoniestifter (vermeidet Konflikte, sucht Ausgleich), Kontrolleur (will alles unter Kontrolle, plant detailliert). Jeder Anteil hat positive Absichten und schützenswerte Bedürfnisse.',
                'TB6': 'GLAUBENSSÄTZE-ANALYSE: Perfektion ("Ich darf keine Fehler machen"), Anerkennung ("Mein Wert hängt von der Meinung anderer ab"), Kontrolle ("Ich muss alles kontrollieren können"), Sicherheit ("Sichtbarkeit ist riskant"), Leistung ("Ich bin nur wertvoll, wenn ich leiste"), Selbstwert ("Ich bin nicht gut genug"). Analysiere die zugrundeliegenden Regeln der Realitätswahrnehmung und deren Schutzfunktion.'
            }}
        };

        let currentStep = 1;
        let stepData = {};
        let sessionId = 'COACH-' + new Date().getFullYear() + '-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');

        function initializeApp() {
            document.getElementById('sessionId').textContent = sessionId;
            loadStepData();
            renderProgressBar();
            renderStepDetails();
            updateNavigation();
            renderRepositoryContent();
            updateSuggestions();
        }

        function renderProgressBar() {
            const progressBar = document.getElementById('progressBar');
            progressBar.innerHTML = '';
            steps.forEach((step, index) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'step';
                if (step.id === currentStep) stepElement.classList.add('active');
                if (stepData[step.id]?.completed) stepElement.classList.add('completed');
                stepElement.innerHTML = `<div class="step-circle">${step.id}</div><div class="step-label">${step.title}</div>`;
                stepElement.onclick = () => goToStep(step.id);
                progressBar.appendChild(stepElement);
            });
        }

        function renderStepDetails() {
            const step = steps.find(s => s.id === currentStep);
            const stepDetails = document.getElementById('stepDetails');
            const phaseClass = `phase-${step.phase.toLowerCase()}`;
            stepDetails.innerHTML = `
                <div class="phase-badge ${phaseClass}">Phase ${step.phase}</div>
                <div class="step-title">${step.id}. ${step.title}</div>
                <ul class="task-list">
                    ${step.tasks.map((task, index) => `
                        <li class="task-item ${stepData[currentStep]?.tasks?.[index] ? 'completed' : ''}">
                            <input type="checkbox" class="task-checkbox" ${stepData[currentStep]?.tasks?.[index] ? 'checked' : ''} onchange="toggleTask(${index})">
                            <span class="task-text">${task}</span>
                        </li>
                    `).join('')}
                </ul>
            `;
        }

        function updateSuggestions() {
            const step = steps.find(s => s.id === currentStep);
            document.getElementById('coacheeSuggestions').innerHTML = `<h4>💡 Empfohlene Fragen:</h4>${step.coachingSuggestions.map(s => `<div class="suggestion-item" onclick="insertText('coachee', '${s}')">${s}</div>`).join('')}`;
            document.getElementById('kiSuggestions').innerHTML = `<h4>🔧 KI-Unterstützung:</h4>${step.assistantSuggestions.map(s => `<div class="suggestion-item" onclick="insertText('ki', '${s}')">${s}</div>`).join('')}`;
        }

        function toggleTask(taskIndex) {
            if (!stepData[currentStep]) stepData[currentStep] = { tasks: [] };
            if (!stepData[currentStep].tasks) stepData[currentStep].tasks = [];
            stepData[currentStep].tasks[taskIndex] = !stepData[currentStep].tasks[taskIndex];
            const step = steps.find(s => s.id === currentStep);
            const allCompleted = step.tasks.every((_, index) => stepData[currentStep].tasks[index]);
            stepData[currentStep].completed = allCompleted;
            saveStepData();
            renderProgressBar();
            renderStepDetails();
        }

        function goToStep(stepId) { currentStep = stepId; renderProgressBar(); renderStepDetails(); updateNavigation(); updateSuggestions(); }
        function previousStep() { if (currentStep > 1) { currentStep--; renderProgressBar(); renderStepDetails(); updateNavigation(); updateSuggestions(); } }
        function nextStep() { if (currentStep < steps.length) { currentStep++; renderProgressBar(); renderStepDetails(); updateNavigation(); updateSuggestions(); } }
        function updateNavigation() { document.getElementById('prevBtn').disabled = currentStep === 1; document.getElementById('nextBtn').disabled = currentStep === steps.length; document.getElementById('stepCounter').textContent = `Schritt ${currentStep} von ${steps.length}`; }

        function sendMessage(chatType) {
            const inputId = chatType + 'Input';
            const messagesId = chatType + 'Messages';
            const input = document.getElementById(inputId);
            const messages = document.getElementById(messagesId);
            
            if (input.value.trim()) {
                const time = new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                const messageClass = chatType === 'coachee' ? 'coach' : chatType;
                const senderName = chatType === 'coachee' ? 'Coach' : chatType === 'ki' ? 'Coach' : 'Coach';
                
                const userMessage = document.createElement('div');
                userMessage.className = `message ${messageClass}`;
                userMessage.innerHTML = `
                    <div class="message-sender">${senderName}</div>
                    ${input.value}
                    <div class="message-time">${time}</div>
                `;
                messages.appendChild(userMessage);
                
                if (chatType !== 'notes') {
                    simulateResponse(chatType, input.value);
                }
                
                input.value = '';
                messages.scrollTop = messages.scrollHeight;
            }
        }

        function simulateResponse(chatType, userMessage) {
            const messagesId = chatType + 'Messages';
            const messages = document.getElementById(messagesId);
            
            setTimeout(() => {
                const time = new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                const responseMessage = document.createElement('div');
                
                if (chatType === 'coachee') {
                    responseMessage.className = 'message coachee';
                    responseMessage.innerHTML = `
                        <div class="message-sender">Coachee</div>
                        Das ist interessant... können Sie mir dabei helfen? Ich fühle mich oft überfordert.
                        <div class="message-time">${time}</div>
                    `;
                } else if (chatType === 'ki') {
                    responseMessage.className = 'message ki';
                    responseMessage.innerHTML = `
                        <div class="message-sender">KI-Assistent</div>
                        <button class="forward-btn" onclick="openForwardModal(\`Basierend auf &quot;${userMessage.substring(0, 30)}...&quot; empfehle ich eine Ausbalancierungsanalyse. Die Aussage deutet auf ein Spannungsfeld zwischen Kontrolle und Vertrauen hin.\`)">→ An Coachee</button>
                        Basierend auf "${userMessage.substring(0, 30)}..." empfehle ich eine Ausbalancierungsanalyse. Die Aussage deutet auf ein Spannungsfeld zwischen Kontrolle und Vertrauen hin. Nutzen Sie Prompt D1 für eine tiefere Analyse der Spannungsfelder.
                        <div class="message-time">${time}</div>
                    `;
                }
                
                messages.appendChild(responseMessage);
                messages.scrollTop = messages.scrollHeight;
            }, 1500);
        }

        function insertText(chatType, text) {
            document.getElementById(chatType + 'Input').value = text;
        }

        function copyCoacheeLink() {
            const coacheeUrl = window.location.origin + '/coachee-interface.html?session=' + sessionId;
            navigator.clipboard.writeText(coacheeUrl).then(() => {
                showCopyFeedback('Coachee-Link kopiert!');
            });
        }

        function startNewSession() {
            sessionId = 'COACH-' + new Date().getFullYear() + '-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
            document.getElementById('sessionId').textContent = sessionId;
            showCopyFeedback('Neue Session gestartet!');
        }

        function openRepository() { document.getElementById('repositoryModal').style.display = 'block'; }
        function closeRepository() { document.getElementById('repositoryModal').style.display = 'none'; }

        function renderRepositoryContent() {
            const content = document.getElementById('repositoryContent');
            content.innerHTML = '';
            Object.keys(promptDatabase).forEach(categoryKey => {
                const category = promptDatabase[categoryKey];
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category';
                categoryElement.innerHTML = `
                    <div class="category-header">${category.title}<div class="category-description">${category.description}</div></div>
                    <div class="prompts-grid">
                        ${Object.keys(category.prompts).map(promptKey => `
                            <div class="prompt-card" onclick="copyPrompt('${promptKey}', \`${category.prompts[promptKey]}\`)">
                                <div class="prompt-code">${promptKey}</div>
                                <div class="prompt-text">${category.prompts[promptKey].substring(0, 80)}...</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                content.appendChild(categoryElement);
            });
        }

        function searchPrompts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categories = document.querySelectorAll('.category');
            categories.forEach(category => {
                const prompts = category.querySelectorAll('.prompt-card');
                let hasVisiblePrompts = false;
                prompts.forEach(prompt => {
                    const code = prompt.querySelector('.prompt-code').textContent.toLowerCase();
                    const text = prompt.querySelector('.prompt-text').textContent.toLowerCase();
                    if (code.includes(searchTerm) || text.includes(searchTerm)) {
                        prompt.style.display = 'block';
                        hasVisiblePrompts = true;
                    } else {
                        prompt.style.display = 'none';
                    }
                });
                category.style.display = hasVisiblePrompts ? 'block' : 'none';
            });
        }

        function copyPrompt(code, text) {
            navigator.clipboard.writeText(text).then(() => {
                showCopyFeedback('Prompt kopiert!');
                const kiInput = document.getElementById('kiInput');
                if (code.startsWith('T') || code.startsWith('TB') || code.startsWith('D')) {
                    kiInput.value = text;
                } else {
                    document.getElementById('coacheeInput').value = text;
                }
            });
        }

        function showCopyFeedback(message = 'Kopiert!') {
            const feedback = document.getElementById('copyFeedback');
            feedback.textContent = message;
            feedback.classList.add('show');
            setTimeout(() => feedback.classList.remove('show'), 2000);
        }

        function saveStepData() { try { localStorage.setItem('coaching-step-data-' + sessionId, JSON.stringify(stepData)); } catch (e) {} }
        function loadStepData() { try { const saved = localStorage.getItem('coaching-step-data-' + sessionId); stepData = saved ? JSON.parse(saved) : {}; } catch (e) { stepData = {}; } }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeRepository();
        });

        window.onclick = function(event) {
            const modal = document.getElementById('repositoryModal');
            if (event.target === modal) closeRepository();
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>